<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ø§ØµÙ„Ø§Ø­Ø§Øª Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 50px;
        }

        .section {
            margin-bottom: 60px;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            border-right: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            font-size: 2.2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.6em;
            margin: 30px 0 20px 0;
        }

        .section h4 {
            color: #555;
            font-size: 1.3em;
            margin: 25px 0 15px 0;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 25px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            direction: ltr;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            border-left: 4px solid #667eea;
        }

        .highlight-box {
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            border-right: 5px solid;
        }

        .highlight-box.success {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .highlight-box.danger {
            background: #ffebee;
            border-color: #f44336;
        }

        .highlight-box.info {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .highlight-box.warning {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .comparison-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .comparison-table th, .comparison-table td {
            padding: 18px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table tr:hover {
            background: #f0f4ff;
        }

        ul, ol {
            padding-right: 30px;
            margin: 20px 0;
        }

        li {
            margin: 12px 0;
            line-height: 1.8;
        }

        .toc {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            border: 2px solid #667eea;
        }

        .toc h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-right: 3px solid #667eea;
            transition: all 0.3s;
        }

        .toc li:hover {
            background: #f0f4ff;
            transform: translateX(-5px);
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            display: block;
        }

        .toc a:hover {
            color: #764ba2;
        }

        .improvement-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-right: 4px solid #4caf50;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .improvement-item h4 {
            color: #4caf50;
            margin-bottom: 10px;
        }

        .step-box {
            background: #fff3cd;
            border-right: 4px solid #ff9800;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .step-box h4 {
            color: #ff9800;
            margin-bottom: 10px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 8px;
        }

        .badge.success {
            background: #4caf50;
            color: white;
        }

        .badge.danger {
            background: #f44336;
            color: white;
        }

        .badge.info {
            background: #2196f3;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ø§ØµÙ„Ø§Ø­Ø§Øª Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h1>
            <p>Ù¾Ú©ÛŒØ¬ Ø¨Ù‡Ø¨ÙˆØ¯ Ùˆ Ø§ØµÙ„Ø§Ø­ Ù¾Ø±ÙˆÚ˜Ù‡ asoud-backend-finial-main</p>
        </div>

        <div class="content">
            <!-- ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨ -->
            <div class="toc">
                <h3>ğŸ“‘ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨</h3>
                <ul>
                    <li><a href="#overview">ğŸ¯ Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø§ØµÙ„Ø§Ø­Ø§Øª</a></li>
                    <li><a href="#logging">ğŸ“ Ø³ÛŒØ³ØªÙ… Logging</a></li>
                    <li><a href="#error-handling">ğŸ›¡ï¸ Error Handling</a></li>
                    <li><a href="#transaction">ğŸ”„ Transaction Management</a></li>
                    <li><a href="#permission">ğŸ”’ Permission Checks</a></li>
                    <li><a href="#validators">âœ… Validators</a></li>
                    <li><a href="#views">ğŸ‘ï¸ Views Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡</a></li>
                    <li><a href="#implementation">ğŸš€ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</a></li>
                    <li><a href="#comparison">ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯</a></li>
                </ul>
            </div>

            <!-- Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ -->
            <section id="overview" class="section">
                <h2>ğŸ¯ Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø§ØµÙ„Ø§Ø­Ø§Øª</h2>
                
                <div class="highlight-box info">
                    <h3>ğŸ“¦ Ù…Ø­ØªÙˆÛŒØ§Øª Ù¾Ú©ÛŒØ¬</h3>
                    <p>Ø§ÛŒÙ† Ù¾Ú©ÛŒØ¬ Ø´Ø§Ù…Ù„ Ø§ØµÙ„Ø§Ø­Ø§Øª Ú©Ø§Ù…Ù„ Ùˆ Ù…Ù†Ø¸Ù… Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ <code>asoud-backend-finial-main</code> Ø§Ø³Øª:</p>
                    <ul>
                        <li>âœ… <strong>Ø³ÛŒØ³ØªÙ… Logging Ú©Ø§Ù…Ù„</strong> - Ø«Ø¨Øª ØªÙ…Ø§Ù… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ùˆ Ø®Ø·Ø§Ù‡Ø§</li>
                        <li>âœ… <strong>Error Handling Ù¾ÛŒØ´Ø±ÙØªÙ‡</strong> - Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ú©Ø²ÛŒ Ø®Ø·Ø§Ù‡Ø§</li>
                        <li>âœ… <strong>Transaction Management</strong> - Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù‚Øµ</li>
                        <li>âœ… <strong>Permission Checks</strong> - Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø§Ù„Ú©ÛŒØª Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ</li>
                        <li>âœ… <strong>Validators Ø¯Ù‚ÛŒÙ‚</strong> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</li>
                        <li>âœ… <strong>Query Optimization</strong> - Ø¨Ù‡Ø¨ÙˆØ¯ Performance</li>
                    </ul>
                </div>

                <div class="improvement-item">
                    <h4>ğŸ¯ Ø§Ù‡Ø¯Ø§Ù Ø§ØµÙ„Ø§Ø­Ø§Øª</h4>
                    <ul>
                        <li><strong>Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù…Ù†ÛŒØª:</strong> Permission Checks Ùˆ Security Logging</li>
                        <li><strong>Ø¨Ù‡Ø¨ÙˆØ¯ Debugging:</strong> Logging Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù…Ø´Ú©Ù„Ø§Øª</li>
                        <li><strong>Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡:</strong> Transaction Management Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù‚Øµ</li>
                        <li><strong>Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ù‚ÛŒÙ‚:</strong> Validators Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</li>
                        <li><strong>Ú©Ø§Ø±Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±:</strong> Query Optimization</li>
                    </ul>
                </div>
            </section>

            <!-- Ø³ÛŒØ³ØªÙ… Logging -->
            <section id="logging" class="section">
                <h2>ğŸ“ Ø³ÛŒØ³ØªÙ… Logging</h2>

                <div class="highlight-box success">
                    <h3>âœ… ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Logging System</h3>
                    <ul>
                        <li><strong>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Log Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡:</strong>
                            <ul>
                                <li><code>market_errors.log</code> - Ø®Ø·Ø§Ù‡Ø§ Ùˆ Exceptionâ€ŒÙ‡Ø§</li>
                                <li><code>market_info.log</code> - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</li>
                                <li><code>payment_transactions.log</code> - ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ</li>
                                <li><code>security_events.log</code> - Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ</li>
                                <li><code>market_debug.log</code> - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Debug (ÙÙ‚Ø· Ø¯Ø± Development)</li>
                            </ul>
                        </li>
                        <li><strong>Rotating File Handlers:</strong> ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ú†Ø±Ø®Ø´ÛŒ Ù‡Ø³ØªÙ†Ø¯ (10MBØŒ 5-10 backup)</li>
                        <li><strong>Context-Aware Logging:</strong> Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª User, IP, Context</li>
                    </ul>
                </div>

                <h3>ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>
                
                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 1: Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„</h4>
                    <div class="code-block">
# Ú©Ù¾ÛŒ logging_config.py Ø¨Ù‡ utils/
cp 01_Utils/logging_config.py utils/logging_config.py
                    </div>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 2: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯Ø± settings.py</h4>
                    <div class="code-block">
# Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ settings.py Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
from utils.logging_config import setup_logging
setup_logging()
                    </div>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 3: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Views</h4>
                    <div class="code-block">
from utils.logging_config import (
    log_info, log_user_action, log_error, 
    log_warning, log_security_event
)

def post(self, request):
    # Log Ø¯Ø±Ø®ÙˆØ§Ø³Øª
    log_info("Market creation request", 
            context={'user_id': request.user.id}, 
            user=request.user)
    
    # ... Ø§Ù†Ø¬Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª ...
    
    # Log Ù…ÙˆÙÙ‚ÛŒØª
    log_user_action(request.user, 'CREATE', 'Market', market.id)
    </div>
                </div>

                <h3>ğŸ“‹ ØªÙˆØ§Ø¨Ø¹ Logging</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ØªØ§Ø¨Ø¹</th>
                            <th>Ú©Ø§Ø±Ø¨Ø±Ø¯</th>
                            <th>Ù…Ø«Ø§Ù„</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>log_info()</code></td>
                            <td>Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</td>
                            <td>log_info("Market created", context={...})</td>
                        </tr>
                        <tr>
                            <td><code>log_error()</code></td>
                            <td>Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ Ø¨Ø§ Traceback</td>
                            <td>log_error(exception, context={...})</td>
                        </tr>
                        <tr>
                            <td><code>log_user_action()</code></td>
                            <td>Ø«Ø¨Øª Ø§Ø¹Ù…Ø§Ù„ Ú©Ø§Ø±Ø¨Ø± (Audit Trail)</td>
                            <td>log_user_action(user, 'CREATE', 'Market', id)</td>
                        </tr>
                        <tr>
                            <td><code>log_security_event()</code></td>
                            <td>Ø«Ø¨Øª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ</td>
                            <td>log_security_event("Unauthorized access", user, ip)</td>
                        </tr>
                        <tr>
                            <td><code>log_payment_transaction()</code></td>
                            <td>Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ</td>
                            <td>log_payment_transaction({...})</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Error Handling -->
            <section id="error-handling" class="section">
                <h2>ğŸ›¡ï¸ Error Handling</h2>

                <div class="highlight-box success">
                    <h3>âœ… ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Error Handling</h3>
                    <ul>
                        <li><strong>ErrorHandlerMixin:</strong> Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ú©Ø²ÛŒ Ø®Ø·Ø§Ù‡Ø§</li>
                        <li><strong>Exception Types:</strong> ValidationError, BusinessLogicError, PaymentError, PermissionError</li>
                        <li><strong>Standardized Response:</strong> ÙØ±Ù…Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Response</li>
                        <li><strong>Context Logging:</strong> Ø«Ø¨Øª Context Ø®Ø·Ø§</li>
                    </ul>
                </div>

                <h3>ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>

                <div class="step-box">
                    <h4>Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ErrorHandlerMixin</h4>
                    <div class="code-block">
from utils.error_handlers import ErrorHandlerMixin, create_error_response

class MarketCreateAPIView(ErrorHandlerMixin, views.APIView):
    def post(self, request):
        try:
            # ...
        except ValidationError as e:
            return create_error_response(e, status.HTTP_400_BAD_REQUEST)
        except Exception as e:
            return create_error_response(e, status.HTTP_500_INTERNAL_SERVER_ERROR)
                    </div>
                </div>

                <h3>ğŸ“‹ Ø§Ù†ÙˆØ§Ø¹ Exception</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Exception Type</th>
                            <th>Ú©Ø§Ø±Ø¨Ø±Ø¯</th>
                            <th>HTTP Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>ValidationError</code></td>
                            <td>Ø®Ø·Ø§Ù‡Ø§ÛŒ Validation</td>
                            <td>400 Bad Request</td>
                        </tr>
                        <tr>
                            <td><code>BusinessLogicError</code></td>
                            <td>Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±</td>
                            <td>422 Unprocessable Entity</td>
                        </tr>
                        <tr>
                            <td><code>PaymentError</code></td>
                            <td>Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</td>
                            <td>422 Unprocessable Entity</td>
                        </tr>
                        <tr>
                            <td><code>PermissionError</code></td>
                            <td>Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ</td>
                            <td>403 Forbidden</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Transaction Management -->
            <section id="transaction" class="section">
                <h2>ğŸ”„ Transaction Management</h2>

                <div class="highlight-box success">
                    <h3>âœ… Ù…Ø²Ø§ÛŒØ§ÛŒ Transaction Management</h3>
                    <ul>
                        <li><strong>Ù‡Ù…Ù‡ ÛŒØ§ Ù‡ÛŒÚ†:</strong> ÛŒØ§ ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ ÛŒØ§ Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…</li>
                        <li><strong>Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡ Ù†Ø§Ù‚Øµ:</strong> Ø§Ú¯Ø± ÛŒÚ© Ø¹Ù…Ù„ÛŒØ§Øª Ø´Ú©Ø³Øª Ø¨Ø®ÙˆØ±Ø¯ØŒ Ù‡Ù…Ù‡ Rollback Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</li>
                        <li><strong>Consistency:</strong> Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø­Ø§Ù„Øª Ø³Ø§Ø²Ú¯Ø§Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯</li>
                    </ul>
                </div>

                <h3>ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>

                <div class="code-block">
from django.db import transaction

class MarketCreateAPIView(views.APIView):
    def post(self, request):
        # âœ… Ø¨Ø§ Context Manager
        with transaction.atomic():
            market = Market.objects.create(...)
            location = MarketLocation.objects.create(...)
            contact = MarketContact.objects.create(...)
            # Ø§Ú¯Ø± ÛŒÚ©ÛŒ Ø´Ú©Ø³Øª Ø¨Ø®ÙˆØ±Ø¯ØŒ Ù‡Ù…Ù‡ Rollback Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
        </div>

                <div class="highlight-box warning">
                    <h4>âš ï¸ Ù…Ø«Ø§Ù„ Ù…Ø´Ú©Ù„ Ø¨Ø¯ÙˆÙ† Transaction:</h4>
                    <div class="code-block">
# âŒ Ø¨Ø¯ÙˆÙ† Transaction:
market = Market.objects.create(...)      # âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯
location = MarketLocation.objects.create(...)  # âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯
contact = MarketContact.objects.create(...)    # âŒ Ø®Ø·Ø§!

# Ù…Ø´Ú©Ù„: Market Ùˆ Location Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‡Ø³ØªÙ†Ø¯ Ø§Ù…Ø§ Contact Ù†ÛŒØ³Øª!
                    </div>

                    <h4>âœ… Ø¨Ø§ Transaction:</h4>
                    <div class="code-block">
# âœ… Ø¨Ø§ Transaction:
with transaction.atomic():
    market = Market.objects.create(...)      # â¸ï¸ Ø¯Ø± Transaction
    location = MarketLocation.objects.create(...)  # â¸ï¸ Ø¯Ø± Transaction
    contact = MarketContact.objects.create(...)    # âŒ Ø®Ø·Ø§!
    
# Ù†ØªÛŒØ¬Ù‡: Ù‡Ù…Ù‡ Rollback Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ âœ…
                    </div>
                </div>
            </section>

            <!-- Permission Checks -->
            <section id="permission" class="section">
                <h2>ğŸ”’ Permission Checks</h2>

                <div class="highlight-box success">
                    <h3>âœ… Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Permission</h3>
                    <ul>
                        <li><strong>Ownership Validation:</strong> Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Market Ù…Ø§Ù„ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª</li>
                        <li><strong>Security Event Logging:</strong> Ø«Ø¨Øª ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²</li>
                        <li><strong>IP Address Tracking:</strong> Ø±Ø¯ÛŒØ§Ø¨ÛŒ IP Address</li>
                    </ul>
                </div>

                <h3>ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>

                <div class="code-block">
# âœ… Ù‚Ø¨Ù„ (Ø¨Ø¯ÙˆÙ† Permission Check):
market = Market.objects.get(id=pk)

# âœ… Ø¨Ø¹Ø¯ (Ø¨Ø§ Permission Check):
try:
    market = Market.objects.get(id=pk, user=request.user)
except Market.DoesNotExist:
    log_security_event(
        "Unauthorized market access attempt",
        user=request.user,
        ip_address=request.META.get('REMOTE_ADDR'),
        details={'market_id': pk}
    )
    return Response({
        'error': 'Market not found or access denied'
    }, status=404)
                </div>
            </section>

            <!-- Validators -->
            <section id="validators" class="section">
                <h2>âœ… Validators</h2>

                <div class="highlight-box success">
                    <h3>âœ… Validators Ù…ÙˆØ¬ÙˆØ¯</h3>
                    <ul>
                        <li><code>validate_business_id()</code> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Business ID</li>
                        <li><code>validate_iranian_national_code()</code> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ (Ø¨Ø§ Checksum)</li>
                        <li><code>validate_iranian_mobile_number()</code> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÛŒØ±Ø§Ù†ÛŒ</li>
                        <li><code>validate_postal_code()</code> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù¾Ø³ØªÛŒ</li>
                        <li><code>validate_working_hours()</code> - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ</li>
                    </ul>
                </div>

                <h3>ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Models</h3>

                <div class="code-block">
from utils.validators import (
    validate_business_id,
    validate_iranian_national_code,
    validate_iranian_mobile_number
)

class Market(models.Model):
    business_id = models.CharField(
        max_length=20,
        unique=True,
        validators=[validate_business_id],  # âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† validator
        ...
    )
    
    national_code = models.CharField(
        max_length=10,
        blank=True,
        null=True,
        validators=[validate_iranian_national_code],  # âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† validator
        ...
    )
                </div>
            </section>

            <!-- Views -->
            <section id="views" class="section">
                <h2>ğŸ‘ï¸ Views Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡</h2>

                <div class="highlight-box success">
                    <h3>âœ… Views Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡</h3>
                    <ul>
                        <li><strong>MarketCreateAPIView</strong> - Transaction, Logging, Error Handling</li>
                        <li><strong>MarketUpdateAPIView</strong> - Permission Check, Transaction</li>
                        <li><strong>MarketGetAPIView</strong> - Query Optimization, Permission Check</li>
                        <li><strong>MarketListAPIView</strong> - Query Optimization</li>
                        <li><strong>MarketLocationCreateAPIView</strong> - Ownership Check, Transaction</li>
                        <li><strong>MarketLocationUpdateAPIView</strong> - Permission Check, Transaction</li>
                        <li>Ùˆ Ø¨Ù‚ÛŒÙ‡ Views...</li>
                    </ul>
                </div>

                <h3>ğŸ“‹ Ø³Ø§Ø®ØªØ§Ø± View Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡</h3>

                <div class="code-block">
class MarketCreateAPIView(ErrorHandlerMixin, views.APIView):
    permission_classes = [permissions.IsAuthenticated]
    
    def post(self, request):
        try:
            # âœ… 1. Log Ø¯Ø±Ø®ÙˆØ§Ø³Øª
            log_info("Market creation request", user=request.user)
            
            # âœ… 2. Validation
            serializer = MarketCreateSerializer(data=request.data)
            if not serializer.is_valid():
                log_warning("Validation failed", errors=serializer.errors)
                return Response(handle_validation_errors(serializer.errors))
            
            # âœ… 3. Transaction Management
            with transaction.atomic():
                market = serializer.save(user=request.user)
                
                # âœ… 4. Log Ù…ÙˆÙÙ‚ÛŒØª
                log_user_action(request.user, 'CREATE', 'Market', market.id)
            
            return Response(...)
            
        except ValidationError as e:
            log_error(e, user=request.user)
            return create_error_response(e)
        except Exception as e:
            log_error(e, user=request.user)
            return create_error_response(e)
                </div>
            </section>

            <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ -->
            <section id="implementation" class="section">
                <h2>ğŸš€ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</h2>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 1: Backup</h4>
                    <div class="code-block">
# Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù¾Ø±ÙˆÚ˜Ù‡ Backup Ø¨Ú¯ÛŒØ±ÛŒØ¯
cp -r apps/market apps/market_backup
cp -r utils utils_backup
                    </div>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 2: Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Utils</h4>
                    <div class="code-block">
cp 01_Utils/logging_config.py utils/
cp 01_Utils/error_handlers.py utils/
cp 01_Utils/validators.py utils/
                    </div>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 3: ØªÙ†Ø¸ÛŒÙ… settings.py</h4>
                    <div class="code-block">
# Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ settings.py:
from utils.logging_config import setup_logging
setup_logging()

# Ø¯Ø± LOGGING config (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    ...
}
                    </div>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 4: Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Models</h4>
                    <p>Ø§Ø² ÙØ§ÛŒÙ„ <code>02_Models_Improvements/market_model_improvements.py</code> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 5: Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Views</h4>
                    <p>Ø§Ø² ÙØ§ÛŒÙ„ <code>03_Views_Improvements/owner_views_improved.py</code> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                    <p>âš ï¸ <strong>ØªØ¯Ø±ÛŒØ¬ÛŒ Ù¾ÛŒØ´ Ø¨Ø±ÙˆÛŒØ¯:</strong> ÛŒÚ© View Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŒ ØªØ³Øª Ú©Ù†ÛŒØ¯ØŒ Ø¨Ø¹Ø¯ View Ø¨Ø¹Ø¯ÛŒ</p>
                </div>

                <div class="step-box">
                    <h4>Ù…Ø±Ø­Ù„Ù‡ 6: ØªØ³Øª</h4>
                    <ul>
                        <li>ØªØ³Øª Create Market</li>
                        <li>ØªØ³Øª Update Market</li>
                        <li>ØªØ³Øª Permission Checks</li>
                        <li>Ø¨Ø±Ø±Ø³ÛŒ Log Files</li>
                    </ul>
                </div>
            </section>

            <!-- Ù…Ù‚Ø§ÛŒØ³Ù‡ -->
            <section id="comparison" class="section">
                <h2>ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯</h2>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Ù…ÙˆØ¶ÙˆØ¹</th>
                            <th>Ù‚Ø¨Ù„ (Ù¾Ø±ÙˆÚ˜Ù‡ Ø§ØµÙ„ÛŒ)</th>
                            <th>Ø¨Ø¹Ø¯ (Ù¾Ø³ Ø§Ø² Ø§ØµÙ„Ø§Ø­Ø§Øª)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Transaction Management</strong></td>
                            <td>âŒ Ù†Ø¯Ø§Ø±Ø¯</td>
                            <td>âœ… Ø¯Ø§Ø±Ø¯ (atomic)</td>
                        </tr>
                        <tr>
                            <td><strong>Logging</strong></td>
                            <td>âŒ Ù†Ø¯Ø§Ø±Ø¯</td>
                            <td>âœ… Ú©Ø§Ù…Ù„ (5 Ù†ÙˆØ¹ Log File)</td>
                        </tr>
                        <tr>
                            <td><strong>Error Handling</strong></td>
                            <td>âš ï¸ Ø³Ø§Ø¯Ù‡</td>
                            <td>âœ… Ù¾ÛŒØ´Ø±ÙØªÙ‡ (Mixin + Exception Types)</td>
                        </tr>
                        <tr>
                            <td><strong>Permission Check</strong></td>
                            <td>âš ï¸ Ø¯Ø± Ø¨Ø±Ø®ÛŒ Views</td>
                            <td>âœ… Ø¯Ø± ØªÙ…Ø§Ù… Views</td>
                        </tr>
                        <tr>
                            <td><strong>Validators</strong></td>
                            <td>âŒ Ù†Ø¯Ø§Ø±Ø¯</td>
                            <td>âœ… Ú©Ø§Ù…Ù„ (5 Validator Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ)</td>
                        </tr>
                        <tr>
                            <td><strong>Query Optimization</strong></td>
                            <td>âš ï¸ Ù…Ø­Ø¯ÙˆØ¯</td>
                            <td>âœ… select_related Ùˆ prefetch_related</td>
                        </tr>
                        <tr>
                            <td><strong>Security Logging</strong></td>
                            <td>âŒ Ù†Ø¯Ø§Ø±Ø¯</td>
                            <td>âœ… Ø¯Ø§Ø±Ø¯ (IP Tracking + Event Logging)</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Ø®Ù„Ø§ØµÙ‡ -->
            <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="color: white; border-color: white;">ğŸ¯ Ø®Ù„Ø§ØµÙ‡</h2>
                <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 10px;">
                    <h3 style="color: white;">âœ… Ø§ØµÙ„Ø§Ø­Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡:</h3>
                    <ul style="color: white; font-size: 1.1em;">
                        <li>âœ… Ø³ÛŒØ³ØªÙ… Logging Ú©Ø§Ù…Ù„ Ø¨Ø§ 5 Ù†ÙˆØ¹ Log File</li>
                        <li>âœ… Error Handling Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ ErrorHandlerMixin</li>
                        <li>âœ… Transaction Management Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª CRUD</li>
                        <li>âœ… Permission Checks Ø¯Ø± ØªÙ…Ø§Ù… Views</li>
                        <li>âœ… Validators Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</li>
                        <li>âœ… Query Optimization Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Performance</li>
                        <li>âœ… Security Event Logging Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ</li>
                    </ul>
                    <br>
                    <p style="font-size: 1.2em; text-align: center; margin-top: 20px;">
                        <strong>Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´ÛŒØ¯! ğŸ‰</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

